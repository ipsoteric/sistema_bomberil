{% extends 'portal/layouts/base.html' %}
{% load static %}

{% block titulo_ventana %}Seleccionar Estación{% endblock %}
{% block titulo_pagina %}{% endblock %}

{% block contenido %}

<div class="selection-container d-flex flex-column justify-content-center align-items-center min-vh-75 py-5">
    
    {# --- ENCABEZADO (igual que antes) --- #}
    <div class="text-center mb-5 animate-fade-in">
        <div class="mb-3">
            <i class="fas fa-fire-extinguisher fs_x_grande color_rojo opacity-75"></i>
        </div>
        <h1 class="fw-bold color_blanco mb-2">Bienvenido, {{ user.first_name|title }}</h1>
        <p class="fs_normal color_blanco_variante">
            {% if user.is_superuser %}
                <span class="badge bg-dark text-white mb-2">MODO ADMINISTRADOR</span><br>
                Selecciona la unidad que deseas gestionar hoy.
            {% else %}
                Selecciona tu cuartel para ingresar al sistema.
            {% endif %}
        </p>
    </div>

    {# --- GRILLA DE ESTACIONES --- #}
    <div class="container">
        {% if estaciones %}
            <div class="row justify-content-center g-4">
                {% for estacion in estaciones %}
                <div class="col-12 col-md-6 col-lg-4 col-xl-3">
                    
                    {# Formulario invisible que envuelve la tarjeta #}
                    <form method="post" action="{% url 'acceso:ruta_seleccionar_estacion' %}" class="h-100">
                        {% csrf_token %}
                        <input type="hidden" name="estacion_id" value="{{ estacion.id }}">
                        
                        {# --- INICIO: CAMBIOS EN LA TARJETA DE ESTACIÓN --- #}
                        <button type="submit" class="card station-card h-100 w-100 text-start border-0 shadow-sm p-0">
                            <div class="card-img-wrapper position-relative">
                                {# Imagen de Fondo: Usar la de la estación o una de stock por defecto #}
                                {% if estacion.imagen_thumb_medium %}
                                <img src="{{ estacion.imagen_thumb_medium.url }}" class="card-img-top" alt="Imagen de {{ estacion.nombre }}">
                                {% else %}
                                <img src="{% static 'portal/imagenes/default-station-cover.jpg' %}" class="card-img-top" alt="Imagen de cuartel de bomberos por defecto">
                                {% endif %}
                                
                                {# Overlay para mejorar contraste del texto #}
                                <div class="card-img-overlay-dark"></div>

                                {# Logo de la Estación: Centrado y ligeramente más grande #}
                                <div class="station-logo-overlay">
                                    {% if estacion.logo_thumb_small %}
                                    <img src="{{ estacion.logo_thumb_small.url }}" class="station-logo" alt="Logo de {{ estacion.nombre }}">
                                    {% else %}
                                    {# Logo de stock por defecto, ejemplo: un escudo genérico #}
                                    <img src="{% static 'portal/imagenes/default-station-logo.png' %}" class="station-logo" alt="Logo de bomberos por defecto">
                                    {% endif %}
                                </div>
                            </div>

                            <div class="card-body d-flex flex-column p-4">
                                
                                {# Contenido de texto #}
                                <div class="z-index-1">
                                    <h5 class="card-title fw-bold color_primario mb-1">
                                        {{ estacion.nombre|title }}
                                    </h5>
                                    <p class="card-text fs_pequena text-muted">
                                        Acceso a funcionalidades.
                                    </p>
                                </div>

                                {# Flecha de acción #}
                                <div class="mt-auto pt-3 text-end z-index-1">
                                    <span class="btn-circle">
                                        <i class="fas fa-arrow-right"></i>
                                    </span>
                                </div>
                                
                                {# Barra de acento (hover) #}
                                <div class="hover-accent"></div>
                            </div>
                        </button>
                        {# --- FIN: CAMBIOS EN LA TARJETA DE ESTACIÓN --- #}
                    </form>

                </div>
                {% endfor %}
            </div>
            
            {% if user.is_superuser %}
            <div class="text-center mt-5 opacity-50 fs_pequena animate-fade-in">
                <i class="fas fa-eye me-1"></i> Visualizando todas las estaciones del sistema.
            </div>
            {% endif %}

        {% else %}
            {% if not user.is_superuser %}
            {# --- ESTADO VACÍO (igual que antes) --- #}
            <div class="card border-danger shadow-sm mw-500 mx-auto animate-fade-in">
                <div class="card-body text-center p-5">
                    <div class="mb-3 text-danger">
                        <i class="fas fa-user-lock fa-3x"></i>
                    </div>
                    <h4 class="fw-bold text-danger">Sin Acceso Asignado</h4>
                    <p class="fs_normal text-muted">
                        No tienes membresías activas en ninguna estación registrada.
                    </p>
                    <a href="{% url 'acceso:ruta_logout' %}" class="btn btn-outline-danger mt-3">
                        <i class="fas fa-sign-out-alt me-2"></i> Cerrar Sesión
                    </a>
                </div>
            </div>
            {% endif %}

        {% endif %}
    </div>
</div>

{% endblock %}