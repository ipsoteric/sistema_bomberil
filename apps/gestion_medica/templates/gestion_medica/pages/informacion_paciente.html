{% extends 'gestion_medica/layouts/base.html' %}
{% load static %}

{% block titulo_ventana %}Ficha: {{ voluntario.usuario.get_full_name }}{% endblock %}
{% block titulo_pagina %}{% endblock %}

{% block contenido %}
<link rel="stylesheet" href="{% static 'gestion_medica/css/ficha_medica.css' %}">

<div class="container-fluid ficha-container">
    <div class="row">

        <div class="col-lg-4 col-xl-3 mb-4">
            <div class="profile-card">
                <div class="profile-header-bg"></div>
                <div class="avatar-container">
                    {% if voluntario.usuario.avatar %}
                        <img src="{{ voluntario.usuario.avatar.url }}" alt="Avatar" class="profile-avatar">
                    {% else %}
                        <div class="profile-avatar d-flex align-items-center justify-content-center text-secondary" style="font-size: 3rem; background: #f8f9fc;">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="patient-info">
                    <h2 class="patient-name">{{ voluntario.usuario.get_full_name }}</h2>
                    <span class="patient-rut">{{ voluntario.usuario.rut }}</span>
                    <div class="blood-badge">
                        <i class="fas fa-tint"></i> <span>{{ ficha.grupo_sanguineo.nombre|default:"?" }}</span>
                        <small>Grupo Sanguíneo</small>
                    </div>
                    <div class="profile-stats">
                        <div class="stat-box">
                            <span class="stat-value">{{ edad|default:"--" }}</span>
                            <span class="stat-label">Años</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-value">{{ ficha.sistema_salud.nombre|default:"--" }}</span>
                            <span class="stat-label">Salud</span>
                        </div>
                    </div>
                </div>
                <div class="profile-actions">
                    <a href="{% url 'gestion_medica:ruta_modificar_paciente' ficha.pk %}" class="btn btn-primary rounded-pill fw-bold py-2">
                        <i class="fas fa-pen me-2"></i> Editar Ficha
                    </a>
                    <a href="{% url 'gestion_medica:ruta_imprimir_ficha' ficha.pk %}" class="btn btn-outline-secondary rounded-pill fw-bold py-2" target="_blank">
                        <i class="fas fa-file-pdf me-2"></i> Generar PDF
                    </a>
                    <a href="{% url 'gestion_medica:ruta_imprimir_qr' ficha.pk %}" class="btn-hero btn-secondary-hero" target="_blank">
                        <i class="fas fa-qrcode"></i> Ver QR
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-8 col-xl-9">

            <div class="vitals-row">
                <div class="vital-card-color vc-blue">
                    <i class="fas fa-weight vc-icon"></i>
                    <div class="vc-value">{{ ficha.peso_kg|default:"--" }}</div>
                    <div class="vc-label">Peso (kg)</div>
                </div>
                <div class="vital-card-color vc-indigo">
                    <i class="fas fa-ruler-vertical vc-icon"></i>
                    <div class="vc-value">{{ ficha.altura_mts|default:"--" }}</div>
                    <div class="vc-label">Altura (m)</div>
                </div>
                <div class="vital-card-color vc-rose">
                    <i class="fas fa-heartbeat vc-icon"></i>
                    <div class="vc-value">
                        {% if ficha.presion_arterial_sistolica %}
                            {{ ficha.presion_arterial_sistolica }}/{{ ficha.presion_arterial_diastolica }}
                        {% else %}
                            --/--
                        {% endif %}
                    </div>
                    <div class="vc-label">P. Arterial</div>
                </div>
            </div>

            <div class="row">

                <div class="col-md-6 mb-4"> <div class="section-card">
                        <div class="section-header header-gradient-alergia">
                            <h3 class="section-title">
                                <i class="fas fa-exclamation-circle"></i> Alergias
                            </h3>
                            <a href="{% url 'gestion_medica:ruta_alergias_paciente' ficha.pk %}" class="btn-soft-add"><i class="fas fa-plus"></i></a>
                        </div>
                        <ul class="modern-list">
                            {% for item in alergias %}
                            <li class="modern-item">
                                <div class="item-icon-box bg-soft-red"><i class="fas fa-allergies"></i></div>
                                <div class="item-text">
                                    <h6>{{ item.alergia.nombre }}</h6>
                                    {% if item.observaciones %} <p>{{ item.observaciones }}</p> {% endif %}
                                </div>
                            </li>
                            {% empty %}
                            <div class="empty-state-modern"><i class="far fa-check-circle"></i>Sin alergias</div>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                 <div class="col-md-6 mb-4">
                    <div class="section-card">
                        <div class="section-header header-gradient-enfermedad">
                            <h3 class="section-title">
                                <i class="fas fa-notes-medical"></i> Enfermedades
                            </h3>
                            <a href="{% url 'gestion_medica:ruta_enfermedad_paciente' ficha.pk %}" class="btn-soft-add"><i class="fas fa-plus"></i></a>
                        </div>
                        <ul class="modern-list">
                            {% for item in enfermedades %}
                            <li class="modern-item">
                                <div class="item-icon-box bg-soft-yellow"><i class="fas fa-procedures"></i></div>
                                <div class="item-text">
                                    <h6>{{ item.enfermedad.nombre }}</h6>
                                    {% if item.observaciones %} <p>{{ item.observaciones }}</p> {% endif %}
                                </div>
                            </li>
                            {% empty %}
                            <div class="empty-state-modern"><i class="far fa-smile"></i>Sin enfermedades</div>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div> <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="section-card">
                        <div class="section-header header-gradient-medicina">
                            <h3 class="section-title">
                                <i class="fas fa-pills"></i> Medicamentos
                            </h3>
                            <a href="..." class="btn-soft-add"><i class="fas fa-plus"></i></a>
                        </div>
                        <ul class="modern-list">
                            {% for item in medicamentos %}
                            <li class="modern-item">
                                <div class="item-icon-box bg-soft-blue"><i class="fas fa-prescription-bottle"></i></div>
                                <div class="item-text">
                                    <h6>{{ item.medicamento.nombre }}</h6>
                                    {% if item.dosis_frecuencia %} <p>{{ item.dosis_frecuencia }}</p> {% endif %}
                                </div>
                            </li>
                            {% empty %}
                            <div class="empty-state-modern"><i class="far fa-file-alt"></i>Sin medicamentos</div>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <div class="col-md-6 mb-4">
                    <div class="section-card">
                        <div class="section-header header-gradient-contacto">
                            <h3 class="section-title">
                                <i class="fas fa-phone-alt"></i> Emergencia
                            </h3>
                            <a href="{% url 'gestion_medica:ruta_contacto_emergencia' ficha.pk %}" class="btn-soft-add"><i class="fas fa-plus"></i></a>
                        </div>
                        <ul class="modern-list">
                            {% for contacto in contactos %}
                            <li class="modern-item">
                                <div class="item-icon-box bg-soft-green"><i class="fas fa-user-shield"></i></div>
                                <div class="item-text" style="flex-grow:1;">
                                    <h6>{{ contacto.nombre_completo }}</h6>
                                    <p>{{ contacto.parentesco }}</p>
                                </div>
                                <a href="tel:{{ contacto.telefono }}" class="btn btn-success btn-sm rounded-circle text-white" style="width:35px; height:35px; display:flex; align-items:center; justify-content:center;">
                                    <i class="fas fa-phone"></i>
                                </a>
                            </li>
                            {% empty %}
                            <div class="empty-state-modern"><i class="far fa-address-book"></i>Sin contactos</div>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div> </div>
    </div>
</div>

<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
</script>
{% endblock contenido %}